# 크리스마스 프로모션

> 우테코 식당의 크리스마스 프로모션을 관리하는 프로그램입니다.
> 사용자에게 날짜와 메뉴를 입력받아 이벤트에서 어떤 혜택을 받을 수 있는지 알려줍니다.

# 기능 목록

## 입력

- [x] 방문할 날짜 입력
  - [x] 숫자가 아닐경우 예외 발생, 재입력
- [x] 주문할 메뉴와 개수 입력
  - [x] 빈 문자열일 경우 예외 발생, 재입력

## 유틸

- [x] 입력값 파싱 : InputParser
  - [x] 날짜 파싱
    - [x] 자연수가 아닐 경우 "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요." 출력하고 재입력
  - [x] 메뉴 파싱
    - [x] 메뉴 형식이 예시와 다를 경우 "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요." 출력하고 재입력

## 컨트롤러

- [x] 로직 호출 및 메세지 전달 도움 : EventController
- [x] 재입력 로직 메서드, 출력 메서드 모음 : EventFacade

## 도메인

- [x] 메뉴 카테고리 열거형 : MenuCategory
- [x] 메뉴 열거형 : Menu
  - 이름, 금액
- [x] 이벤트 인터페이스 : Event
  - 이벤트의 할인금액 반환
  - 이름 반환
- [x] 이벤트 추상클래스 : AbstractEvent
  - Event에 존재할 공통 로직 : 만원 이상인지 검사, 날짜가 이벤트 기간인지 검사
  - 각자 하위 클래스에서 가져야할 함수 : 할인 계산 함수
  - 이름, 시작날, 마지막날, 할인가격, 할인 로직 등 모든 이벤트가 어떻게 적용되는지 계산가능
  - [x] 크리스마스 디데이 할인 : 크리스마스 다가올수록 할인금 증가
  - [x] 평일 할인 : 평일에 디저트 개당 2023원 할인
  - [x] 주말 할인 : 주말에 메인메뉴 개당 2023원 할인
  - [x] 특별 할인 : 총주문 금액에서 천원 할인
  - [x] 증정 이벤트 : 12만원 이상일 때 할인
- [x] 배지 열거형 : Badge
  - 금액으로 알맞은 배지 반환

- [x] 문자열 Enum 으로 변환 : MenuService 

- [x] 입력 날짜 객체 : Date
  - 날짜 유효성 보증 책임
    - 예외 발생시 "[ERROR] 유효하지 않은 날짜입니다. 다시 입력해 주세요." 출력하고 재입력
    - [x] 1~31의 숫자 아닐 경우
- [x] 주문한 메뉴 객체 : OrderedMenu
  - 저장된 메뉴의 총액 계산 기능
  - 메뉴 유효성 보증 책임
    - 예외 발생시 "[ERROR] 유효하지 않은 주문입니다. 다시 입력해 주세요." 출력하고 재입력
    - [x] 메뉴판에 없는 메뉴를 입력할 경우
    - [x] 메뉴 개수 1 이상의 숫자가 아닐 경우
    - [x] 중복 메뉴 입력할 경우
    - [x] 음료만 주문 불가능
    - [x] 메뉴 최대 20개까지 가능
- [x] 적용된 이벤트 객체 : AppliedEvents
  - 정적 팩터리 메서드
  - 어떤 Event의 할인이 얼마나 적용되었는지 한번에 저장하는 객체
  - 적용된 이벤트의 총액 계산 책임
  - 총액이 10000 이상일 때만 이벤트 적용

## 출력

- [x] 주문 메뉴 출력
- [x] 할인 전 총주문 금액 출력
- [x] 증정 메뉴 출력
- [x] 혜택 내역 출력
  - 모든 적용 이벤트 출력
- [x] 총혜택 금액 출력
- [x] 할인 후 예상 결제 금액 출력
- [x] 12월 이벤트 베지 출력

## 학습 목표

> 클래스(객체)를 분리하는 연습

1. 클래스의 역할과 책임을 생각해 보고
2. 도메인 로직에 집중하는 방향으로 구현
3. UI는 도메인 로직과 분리
   - View 에서 사용할 데이터는 getter로 데이터 전달
   - 연관성이 있는 상수는 static final 대신 enum 활용
   - 불면 값은 final 로 변경 막기
   - 데이터를 꺼내지 말고, 메세지를 던지도록 구조를 바꿔서 데이터를 가지는 객체가 일하도록 [참고 게시글](https://tecoble.techcourse.co.kr/post/2020-04-28-ask-instead-of-getter/)
   - 필드 (인스턴스 변수)가 많으면 복잡도가 높아 버그 발생 가능성이 높아지므로 줄이기 위해 노력하기.
   - 예외 상황 잘 찾아서 테스트 하기
   - 메소드 분리는 가독성 상승에 좋다. 성능이 떨어져도 된다

## 리팩토링

- [x] 정적 팩토리 메서드 써보기
- [x] 객체의 역할 다시 생각해보기
  - [x] Event Enum -> 클래스 인터페이스 추상클래스, 구현체로 바꾸기
- [x] 객체가 데이터를 꺼내는것이 아닌 메세지를 서로 주고받고 있는지 체크
- [ ] 테스트 코드 개선하기 (예외 상황 잘 찾아서)
- [x] 문자열 래핑
- [ ] 12월 아니여도 적용 가능하게 확장성 개선
- [x] 메뉴판 출력
- [x] Facade 패턴 적용

## 문제해결

### 객체의 역할

사용자의 메뉴 입력 정보가 분석되는 단계이다.

1. 문자열 -> 기본 입력 검증 (빈 문자열 등)
2. 기본 검증된 문자열 -> 입력 형식에 올바른지 검증
3. 입력 형식 검증된 문자열 -> List<String, Integer>
4. List<String, Integer> -> List<Menu, Integer>
5. List<Menu, Integer> -> OrderedMenu 객체

이 모든 기능을 도메인, View, Controller, domain, Util 등 어떤 패키지에서 어떤 클래스가 동작해야하는지 생각해봤다.

1. 문자열 -> 기본입력 검증 (빈 문자열, 숫자가 아닌 경우 등)

입력이 뷰에서 들어오기 때문에 아주 기본적인 검증은 뷰의 역할이라고 생각했다.

2. 기본 검증된 문자열 -> 입력 형식에 올바른지 검증

입력 형식이라는 것은 비즈니스 로직과는 무관하다고 볼 수 있고,
비즈니스 로직은 그대로지만 입력 형식을 바꾸고 싶을때,
도메인 영역을 건들지 않고 수정할 수 있게 하기위해 util 패키지 - InputParser 의 역할로 했다.

3. 입력 형식 검증된 문자열 -> List<String, Integer>

이것도 마찬가지 입력 형식을 구조화 하는것은 util 패키지 - InputParser의 역할이다.

4. List<String, Integer> -> List<Menu, Integer>

이 부분은 문자열을 Menu 라는 도메인 객체로 만드므로 컨트롤러 또는 서비스 계층의 역할이다.
컨트롤러에 구현하면 컨트롤러의 역할이 너무 많아질 것 같으므로 서비스 클래스에 맡기기로 했다.

5. List<Menu, Integer> -> OrderedMenu 객체

직접적인 OrderedMenu 객체 생성 도메인의 책임이므로,
OrderedMenu 객체 내부의 생성자 또는 팩토리 메소드에서 수행하기로 했다.

### 이벤트 객체 만들기

이번 과제에서 이벤트 하나에 많은 정보가 들어간다. (이름, 적용날짜, 적용 음식 카테고리, 할인방법) 이것을 어떻게 코드로 표현할까 고민했다.

이름부터 카테고리 까지는 Enum으로 하는게 확실히 좋아보여서 일단 모두 그렇게 했다.
그런데 할인방법을 이벤트마다 적용했더니 모든 Enum 마다 각기 다른 함수를 적용해야 했고, Event 객체의 길이가 100줄이 넘어갔다.
이건 객체의 역할이 너무 많다 싶어서 클래스, 상속 방식으로 구현 하는것이 나을것 같아서 그렇게 했다.

일단 Event 라는 인터페이스를 만들고, 추상클래스로 그것을 구현해서 공통 기능을 작성하고,
나머지 이벤트 클래스들이 그것을 상속받아서 각자 다른 점을 따로 구현했다.

**클래스로 바꾸고 나서 장점**
- 유연성, 재사용성, 확장성이 좋다.
- Enum 에서의 중복 코드를 줄일 수 있었다. 

**Enum에 비해 단점**
- 타입 안정성이 보장되지 않는다.
- 클래스 구조가 복잡하다.
- 이벤트를 다루는 로직이 좀 더 복잡해졌다.

## 리팩토링

### 메서드 분리

- Controller 코드 줄이 110줄이 넘어갔다. 컨트롤러는 한눈에 바로 들어오게 하고 싶어서
  메소드 구현체를 EventFacade 클래스로 옮겼다.

### 객체에게 메세지 보내기

객체의 상태를 꺼내와서 로직을 적용하는 것을 지양하고, 메세지를 받아서 계산한 후 결과를 반환하도록 했다.

- Date 객체에게 요일 확인 의 책임을 전부 가지게 했다. Data.value 를 직접 꺼내는 경우는 View 에서 사용하는 경우 말고는 없어졌다.
- 마찬가지로 전체 할인금, 최종 결제금 계산을 AppliedEvent 안에서 수행해서 반환하도록 했다.

### 기능 추가

- MenuCategory 에 한글 이름 변수를 추가해서 메뉴판 출력 로직을 만들었다.

### 테스트 코드 개선

- 모든 이벤트 클래스의 테스트 코드를 작성하는것이 번거로워 EventTest 안에서 모두 수행했었다.
- 하지만 예외 테스트에 구멍이 났을 수도 있다는 생각에 각 이벤트 별로 단위테스트를 작성했다.
- 테스트 코드를 작성하다 보면 중복 로직을 검증하는 테스트가 많아질 때도 있는데, 그러지 않기 위해 객체의 역할이 뭔지 생각해보고 그것을 집중적으로 테스트하는것이 중요한것 같다.
- 2주차때 TDD 를 해보고 너무 오래 걸렸어서 이번에는 일단 구현을 한 후 테스트 코드를 작성해서 논리 오류를 잡고, 리팩토링 과정에서 생기는 오류를 방지했다.
